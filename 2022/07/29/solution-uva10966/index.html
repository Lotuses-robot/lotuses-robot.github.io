<!DOCTYPE html>
<html lang="zh">
    <head>
  <!-- 元数据 -->
  <meta charset="utf-8">
  <link rel="icon" href="https://cdn.luogu.com.cn/upload/usericon/414231.png">
  
  <title>UVA10966 3KP-BASH Project Sol. | Lotuses&#39;s Blog</title>
  <meta name="author" content="Lotuses" />
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="robots" content="index,follow" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="format-detection" content="telphone=no, email=no" />
  
    <meta name="keywords" content="" />
  
  <meta name="description" content="啊…太坑了 我放弃了 为了让后人不再掉坑，我在这里将刘汝佳在《算法竞赛入门经典——训练指南》中的翻译打出来。 （为了加强严密性，题目文字根据官方数据进行了增删） 你的任务是为一个假想的 3KP 操作系统编写一个简单的 Bash 模拟器。 由于操作系统本身还没有写完，你暂时需要在模拟器的内存中虚拟出一个文件系统，而不是和真是的文件系统交互。 下面介绍 3KP 操作系统中的文件系统。 文件（file）">
<meta property="og:type" content="article">
<meta property="og:title" content="UVA10966 3KP-BASH Project Sol.">
<meta property="og:url" content="https://www.lotuses.net/2022/07/29/solution-uva10966/index.html">
<meta property="og:site_name" content="Lotuses&#39;s Blog">
<meta property="og:description" content="啊…太坑了 我放弃了 为了让后人不再掉坑，我在这里将刘汝佳在《算法竞赛入门经典——训练指南》中的翻译打出来。 （为了加强严密性，题目文字根据官方数据进行了增删） 你的任务是为一个假想的 3KP 操作系统编写一个简单的 Bash 模拟器。 由于操作系统本身还没有写完，你暂时需要在模拟器的内存中虚拟出一个文件系统，而不是和真是的文件系统交互。 下面介绍 3KP 操作系统中的文件系统。 文件（file）">
<meta property="og:locale">
<meta property="og:image" content="https://cdn.luogu.com.cn/upload/usericon/414231.png">
<meta property="article:published_time" content="2022-07-29T07:56:31.000Z">
<meta property="article:modified_time" content="2022-07-29T07:56:31.643Z">
<meta property="article:author" content="Lotuses">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.luogu.com.cn/upload/usericon/414231.png">
  
  <!-- 站点验证相关 -->
  
    
    
    
  
  <!-- 样式表文件 -->
  <link rel="stylesheet" id="kratos-css" href="/css/kratosr.min.css" media="all"></script>
  
    <link rel="stylesheet" id="darkmode-css" href="/css/kr-color-dark.min.css" media="(prefers-color-scheme: dark)"></script>
    <script src="/js/kr-dark.min.js"></script>
  
  
    <link rel="stylesheet" id="highlight-css" href="/css/highlight/night-eighties.min.css" media="all"></script>
  
  <link rel="stylesheet" id="fontawe-css" href="/vendors/font-awesome@4.7.0/css/font-awesome.min.css" media="all"></script>
  <link rel="stylesheet" id="nprogress-css" href="/vendors/nprogress@0.2.0/nprogress.css" media="all"></script>
  
  
  
    <link rel="stylesheet" href="/vendors/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"></script>
  
  <!-- 不得不预先加载的一些JS文件 -->
  <script src="/vendors/jquery@3.6.0/dist/jquery.min.js"></script>
  
    <script src="/vendors/qrcode_js@1.0.0/qrcode.min.js"></script>
  
  
  <style>
    
      .kratos-cover.kratos-cover-2 {
        background-image: url('https://cdn.luogu.com.cn/upload/image_hosting/05j8cwf8.png');
      }
    
    
      @media(min-width:768px) {
        body.custom-background {
          background-image: url('/images/no-background.png');
        }
      }
    
  </style>
  
<meta name="generator" content="Hexo 6.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>


    <body class="custom-background">
        <div id="kratos-wrapper">
    <div id="kratos-page">
        <div id="kratos-header">
            <header id="kratos-desktop-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="nav-header">
                        <nav id="kratos-menu-wrap">
                            <ul id="kratos-primary-menu" class="sf-menu">
                                
                                    
                                        <li>
                                            
                                                <a href="/">
                                            
                                                
                                                    <i class="fa fa-home"></i>
                                                
                                                首页
                                            </a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="/archives/">
                                            
                                                
                                                    <i class="fa fa-file"></i>
                                                
                                                档案馆
                                            </a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="/friends/">
                                            
                                                
                                                    <i class="fa fa-paw"></i>
                                                
                                                友链
                                            </a>
                                            
                                        </li>
                                    
                                
                            </ul>
                        </nav>
                    </div>
                </div>
            </header>
            <header id="kratos-mobile-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="color-logo"><a href="/">Lotuses&#39;s Blog</a></div>
                    <div class="nav-toggle">
                        <a class="kratos-nav-toggle js-kratos-nav-toggle">
                            <i></i>
                        </a>
                    </div>
                </div>
            </header>
        </div>
        <div class="kratos-start kratos-hero-2">
            <!-- <div class="kratos-overlay"></div> -->
            <div class="kratos-cover kratos-cover-2 text-center">
                <div class="desc desc2 animate-box">
                    <a href="/">
                        <h2>Lotuses&#39;s Blog</h2> <br />
                        <span></span>
                    </a>
                </div>
            </div>
        </div>

        <div id="kratos-blog-post">
            <div class="container">
                <div id="main" class="row">
                    

        

            <section class="col-md-8">

        

            <article itemscope itemtype="https://schema.org/Article">
    
    <link itemprop="mainEntityOfPage" href="https://www.lotuses.net/2022/07/29/solution-uva10966/">
    <div class="kratos-hentry kratos-post-inner clearfix">
        <header class="kratos-entry-header">
            
                <h1 class="kratos-entry-title text-center" itemprop="name headline">UVA10966 3KP-BASH Project Sol.</h1>
            
            
            <ul class="kratos-post-meta text-center">
                <li><time datetime="2022-07-29T07:56:31.000Z" itemprop="datePublished"><i class="fa fa-calendar"></i> 2022-07-29</time></li>
                <li itemprop="author" itemscope itemtype="https://schema.org/Person">
                    <i class="fa fa-user"></i> 作者 <span itemprop="name">Lotuses</span>
                </li>
                <li>
                    <i class="fa fa-edit"></i> 
                    
                    
                        ~24.88K
                    
                    字
                </li>
                
            </ul>
        </header>
        <div class="kratos-post-content">
            
            <div id="expire-alert" class="alert alert-warning hidden" role="alert">
                <div class="icon"><i class="fa fa-warning"></i></div>
                <div class="text"><p>本文最后编辑于 <time datetime="1659081391643"></time> 前，其中的内容可能需要更新。</p></div>
            </div>
            
            
            
                <div class="kratos-post-inner-toc toc-div-class" >
                    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-cd-path"><span class="toc-number">1.</span> <span class="toc-text">1. cd path</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-touch-filename-size-h"><span class="toc-number">2.</span> <span class="toc-text">2. touch filename [-size] [-h]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-mkdir-path-h"><span class="toc-number">3.</span> <span class="toc-text">3. mkdir path [-h]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-find-filename-r-h"><span class="toc-number">4.</span> <span class="toc-text">4. find filename [-r] [-h]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-ls-path-h-r-s-S-f-d"><span class="toc-number">5.</span> <span class="toc-text">5. ls [path] [-h] [-r] [-s] [-S] [-f] [-d]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-pwd"><span class="toc-number">6.</span> <span class="toc-text">6. pwd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-exit"><span class="toc-number">7.</span> <span class="toc-text">7. exit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-grep-%E2%80%9Cstring%E2%80%9D"><span class="toc-number">8.</span> <span class="toc-text">8. grep “string”</span></a></li></ol>
                </div>
            
            <hr />
            <div itemprop="articleBody"><p>啊…太坑了</p>
<p><s>我放弃了</s></p>
<p>为了让后人不再掉坑，我在这里将刘汝佳在《算法竞赛入门经典——训练指南》中的翻译打出来。</p>
<p>（为了加强严密性，题目文字根据官方数据进行了增删）</p>
<p>你的任务是为一个假想的 3KP 操作系统编写一个简单的 Bash 模拟器。</p>
<p>由于操作系统本身还没有写完，你暂时需要在模拟器的内存中虚拟出一个文件系统，而不是和真是的文件系统交互。</p>
<p>下面介绍 3KP 操作系统中的<strong>文件系统</strong>。</p>
<p><strong>文件（file）<strong>是数据存储的</strong>最小单位</strong>。文件名有英文字母（大小写敏感）、数字和点（<code>.</code>）组成，<strong>但不能包含两个连续的点，且用户创建的文件名不能是单个的点字符（即 <code>.</code> ）</strong>。</p>
<p>文件名长度不能超过 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="3.394ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1500 688"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(500,0)"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(1000,0)"></path></g></g></g></svg></mjx-container>，文件大小不能超过 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.919ex" height="1.887ex" role="img" focusable="false" viewBox="0 -833.9 1290.1 833.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="TeXAtom" transform="translate(533,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(500,0)"></path></g></g></g></g></g></svg></mjx-container>。一个文件可能具有 <strong>directory 属性和 hidden 属性</strong>。</p>
<p><strong>目录（directory）</strong> 是一个大小为 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g></svg></mjx-container>，具有 directory 属性的文件，里面可以保存任意数量的文件（无论属性）。</p>
<p><strong>空文件系统只有一个文件，叫做“根目录”</strong>。在任意时刻，有一个称为“当前目录”的目录。Bash 启动时，当前目录就是根目录。</p>
<p>指令中引用文件的时候，<strong>可以使用绝对路径和相对路径</strong>。</p>
<p>绝对路径以字符“/”开头，如“/home/acm/uva”；相对路径不以字符“/”，当前目录和父目录分别用“.”和“…”表示。</p>
<p>如当前目录为“/home/acm/uva”，那么“…/…/…/home/…”就是根目录。</p>
<p>这里展示访问的过程：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/home/acm/uva  初始目录</span><br><span class="line">/home/acm     ../</span><br><span class="line">/home         ../</span><br><span class="line">/             ../</span><br><span class="line">/home         home/</span><br><span class="line">/             ..</span><br></pre></td></tr></table></figure>
<p>你的 Bash 模拟器需要支持 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g></g></g></svg></mjx-container> 个命令，具体如下：</p>
<p>（没有 [] 标志的参数为必选参数）</p>
<p>（又：Markdown 表格不支持回车，只能直接打了 qwq)</p>
<h3 id="1-cd-path">1. <strong>cd</strong> path</h3>
<p>改变当前目录。path 可以是相对路径，也可以是绝对路径。</p>
<p>如果目录不存在或名字不合法，输出 <code>path not found</code></p>
<h3 id="2-touch-filename-size-h">2. <strong>touch</strong> filename [-size] [-h]</h3>
<p>修改文件。</p>
<p>filename 应由两部分组成，前一部分是目录（为空就是当前目录），后一部分为文件名。</p>
<p>比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/fc.cpp        -&gt; 目录：/           文件名： fc.cpp</span><br><span class="line">/home/fc.cpp   -&gt; 目录：/home       文件名： fc.cpp</span><br><span class="line">qwq.cpp        -&gt; 目录：（当前目录） 文件名： qwq.cpp</span><br></pre></td></tr></table></figure>
<p>都是合法的。</p>
<p>其中的文件名应当是合法的文件名，否则输出 <code>bad usage</code>（见后）。其中的目录应当是当前文件系统中存在的目录，否则输出 <code>path not found</code>。</p>
<p>在正常情况下，同名<strong>文件</strong>（如果有的话），应当先被删除，然后新建文件。</p>
<p>文件的大小由 -size 参数决定（若没有参数 -size 默认为 0），参数 -h 表示创建隐藏文件。用户不会制定多个 -size 参数。</p>
<p>如果存在一个同名的目录，输出 <code>a directory with the same name exists</code>。</p>
<h3 id="3-mkdir-path-h">3. <strong>mkdir</strong> path [-h]</h3>
<p>与 touch 类似。</p>
<p>创建目录。</p>
<p>path 应由两部分组成，前一部分是目录（为空就是当前目录），后一部分为新建目录名。</p>
<p>其中要新建的目录名应当是合法的目录名，否则输出 <code>bad usage</code>。其中的目录应当是当前文件系统中存在的目录，否则输出 <code>path not found</code>。</p>
<p>参数 -h 表示创建隐藏目录。</p>
<p>如果存在同名目录或文件，输出 <code>file or directory with the same name exists</code>。</p>
<h3 id="4-find-filename-r-h">4. <strong>find</strong> filename [-r] [-h]</h3>
<p>查找目录或文件。</p>
<p>filename 应由两部分组成，前一部分是目录（为空就是当前目录），后一部分表示要查找的文件名（注意，这里表示在<strong>前一部分目录中</strong>寻找<strong>后一部分中的文件</strong>）。</p>
<p>前一部分目录应当是当前文件系统中存在的目录，否则输出 <code>path not found</code>。</p>
<p>-r 参数表示要查找的目录下的所有子目录都要查找。默认情况下，find 命令不会显示隐藏文件，（<strong>但是在有 -r 参数的情况下是会搜索隐藏子目录的</strong>），如果指定了 -h 参数，则会显示所有搜索到的隐藏文件。</p>
<p>如果没有找到<strong>需要输出</strong>的文件，则输出 <code>file not found</code>。否则对于找到的每个文件，输出单独的一行，按顺序会这样输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filepath/filename size [hidden] [dir]</span><br></pre></td></tr></table></figure>
<p>其中如果结果是隐藏或目录文件，则<strong>依次</strong>输出 hidden 和 dir。中间要有空格隔开。</p>
<p>结果应当按每个文件的绝对路径的字典序从小到大排序。</p>
<h3 id="5-ls-path-h-r-s-S-f-d">5. <strong>ls</strong> [path] [-h] [-r] [-s] [-S] [-f] [-d]</h3>
<p>展示目录中文件。</p>
<p>总共 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.579ex" role="img" focusable="false" viewBox="0 -676 500 698"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path></g></g></g></svg></mjx-container> 个可选参数，没有必选参数。</p>
<p>ls 展示方式与 find 相同。</p>
<p>path 指定展示的目录。若没有 path 选项，则制定当前目录为要展示的目录。</p>
<p>-h，-r 与 find 指令相同。</p>
<p>-s，-S 表示输出的顺序，-s 表示按照文件大小<strong>从小到大</strong>排序，-S 表示按照文件大小<strong>从大到小</strong>排序。如果没有制定其中任意一个参数，那么排序方式与 find 一样。又如果，两文件大小相同，那么也按照 find 的比较方式来排序。</p>
<p>比如说，如果没有指定 -s 和 -S 参数的结果是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/0/a.cpp 4283</span><br><span class="line">/1/a.cpp 4589859858</span><br><span class="line">/2.cpp 0</span><br><span class="line">/a/a.cpp 4283</span><br></pre></td></tr></table></figure>
<p>那么指定了 -s 的参数排序如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/2.cpp 0</span><br><span class="line">/0/a.cpp 4283</span><br><span class="line">/a/a.cpp 4283</span><br><span class="line">/1/a.cpp 4589859858</span><br></pre></td></tr></table></figure>
<p>指定了 -S 的参数排序如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/1/a.cpp 4589859858</span><br><span class="line">/0/a.cpp 4283</span><br><span class="line">/a/a.cpp 4283</span><br><span class="line">/2.cpp 0</span><br></pre></td></tr></table></figure>
<p>-f 表示只显示没有 directory 属性的文件；</p>
<p>-d 表示只显示有 directory 属性的文件。</p>
<p><strong>注意：两个参数可以同时出现。</strong></p>
<h3 id="6-pwd">6. pwd</h3>
<p>输出当前目录的绝对路径。</p>
<h3 id="7-exit">7. exit</h3>
<p>退出 Bash。</p>
<p>在本题中，表示初始化 Bash。</p>
<h3 id="8-grep-“string”">8. grep “string”</h3>
<p>筛出输入字符串中含有 string 串的行。</p>
<p>在本题中，grep 只能通过管道调用。</p>
<p>何为管道？</p>
<p>简单理解，就是将管道分隔符（<code>|</code>）<strong>前面的程序输出结果</strong>输入到后面的程序中。</p>
<p>比如说，假设 ls 命令当前是能够输出这些内容的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/1 5</span><br><span class="line">/5 6</span><br><span class="line">/6 7</span><br><span class="line">/3 5 hidden</span><br></pre></td></tr></table></figure>
<p>如果我的命令是这样子的：<code>ls | grep "5"</code></p>
<p>那么，grep 会筛取前面输入的字符串，并筛去不含 “5” 的行。</p>
<p>加上 grep 结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/1 5</span><br><span class="line">/5 6</span><br><span class="line">/3 5 hidden</span><br></pre></td></tr></table></figure>
<p><strong>注意：管道可以叠加使用，只检查 string（不带有双引号）。</strong></p>
<p>对于上面的结果，我们其实可以再添加一层 grep。</p>
<p>命令变为 <code>ls | grep "5" | grep " 5"</code>（注意后面的 grep 中有空格），那么输出就变成了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/1 5</span><br><span class="line">/3 5 hidden</span><br></pre></td></tr></table></figure>
<p>由于在前一次 grep 结果中，第二行找不到 <code>" 5"</code>，所以，第二行被筛去了。</p>
<p>命令行中每一行包含一条或多条命令，用管道分隔符隔开（管道分隔符前后不一定有空格）。</p>
<p>第一条命令必须是除了 grep 之外的上述命令之一，而剩下的命令必须是 grep。</p>
<p>如果违反上述（上两行）中的规定，应输出 <code>bad usage</code>，并且不执行任何之后的命令（即之后的 grep）。</p>
<p>比如说：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ls | grep "s"|grep "s2"  合法</span><br><span class="line">ls | ls | grep "ss"      不合法，后面的 grep 不执行，直</span><br><span class="line">                         接输出 bad usage</span><br><span class="line">grep | ls                不合法</span><br></pre></td></tr></table></figure>
<p>输入保证满足以下条件：</p>
<ol>
<li>
<p>每个命令的必选参数（如果有的话）都是第一个参数，可选参数在必选参数之后，但可能以任意顺序出现。</p>
</li>
<li>
<p>命令和参数，参数和参数之间保证有一个或多个空格。</p>
</li>
<li>
<p>用户不会忽略必选参数，不会使用非法参数，也不会在除了 grep 外的其他命令中使用引号。</p>
</li>
</ol>
<p>如果第一条命令是 touch 或者 mkdir，且命令返回 <code>bad usage</code>，则不执行后面的命令（即 grep）。</p>
<p>模拟思路：</p>
<ol>
<li>
<p>拆分命令和参数。</p>
</li>
<li>
<p>用一棵树来表示文件系统。</p>
</li>
<li>
<p>注意以格式化输出。</p>
</li>
</ol>
<p>这里<s>贴心</s>的附上刘汝佳的代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UVa10966 3KP-Bash Project</span></span><br><span class="line"><span class="comment">// Rujia Liu</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="keyword">typedef</span> vector&lt;<span class="type">int</span>&gt; VI;</span><br><span class="line"><span class="keyword">typedef</span> vector&lt;string&gt; VS;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> string ERROR_BAD_USAGE = <span class="string">"bad usage\n"</span>;</span><br><span class="line"><span class="type">const</span> string ERROR_NO_COMMAND = <span class="string">"no such command\n"</span>;</span><br><span class="line"><span class="type">const</span> string ERROR_DIR_NOT_FOUND = <span class="string">"path not found\n"</span>;</span><br><span class="line"><span class="type">const</span> string ERROR_DIR_FOUND = <span class="string">"a directory with the same name exists\n"</span>;</span><br><span class="line"><span class="type">const</span> string ERROR_DIR_OR_FILE_FOUND = <span class="string">"file or directory with the same name exists\n"</span>;</span><br><span class="line"><span class="type">const</span> string ERROR_FILE_NOT_FOUND = <span class="string">"file not found\n"</span>;</span><br><span class="line"><span class="type">const</span> string ERROR_EMPTY = <span class="string">"[empty]\n"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// if delim != ' ', make sure that no space characters exist in s</span></span><br><span class="line"><span class="function">VS <span class="title">split</span><span class="params">(string s, <span class="type">char</span> delim=<span class="string">' '</span>)</span> </span>{</span><br><span class="line">  <span class="keyword">if</span>(delim != <span class="string">' '</span>)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; s.<span class="built_in">length</span>(); i++) <span class="keyword">if</span>(s[i] == delim) s[i] = <span class="string">' '</span>;</span><br><span class="line">  <span class="function">stringstream <span class="title">ss</span><span class="params">(s)</span></span>;</span><br><span class="line">  VS ret;</span><br><span class="line">  string x;</span><br><span class="line">  <span class="keyword">while</span>(ss &gt;&gt; x) ret.<span class="built_in">push_back</span>(x);</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// return 1 if success, 0 if on error</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_int</span><span class="params">(string s, LL&amp; v)</span> </span>{</span><br><span class="line">  <span class="function">stringstream <span class="title">ss</span><span class="params">(s)</span></span>;</span><br><span class="line">  <span class="keyword">if</span>(ss &gt;&gt; v) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">string <span class="title">trim</span><span class="params">(string s)</span> </span>{</span><br><span class="line">  <span class="type">int</span> L, R;</span><br><span class="line">  <span class="keyword">for</span>(L = <span class="number">0</span>; L &lt; s.<span class="built_in">length</span>(); L++) <span class="keyword">if</span>(!<span class="built_in">isspace</span>(s[L])) <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">for</span>(R = s.<span class="built_in">length</span>()<span class="number">-1</span>; R &gt; L; R--) <span class="keyword">if</span>(!<span class="built_in">isspace</span>(s[R])) <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">return</span> s.<span class="built_in">substr</span>(L, R-L+<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">File</span> {</span><br><span class="line">  <span class="type">int</span> parent;</span><br><span class="line">  string name;</span><br><span class="line">  string fullpath; <span class="comment">// cached fullpath name</span></span><br><span class="line">  LL size;</span><br><span class="line">  <span class="type">bool</span> dir;</span><br><span class="line">  <span class="type">bool</span> hidden;</span><br><span class="line">  vector&lt;<span class="type">int</span>&gt; subdir;</span><br><span class="line">  <span class="built_in">File</span>(<span class="type">int</span> parent=<span class="number">0</span>, string name=<span class="string">""</span>, LL size=<span class="number">0</span>, <span class="type">bool</span> dir=<span class="literal">true</span>, <span class="type">bool</span> hidden=<span class="literal">false</span>):<span class="built_in">parent</span>(parent),<span class="built_in">name</span>(name),<span class="built_in">size</span>(size),<span class="built_in">dir</span>(dir),<span class="built_in">hidden</span>(hidden) {}</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">vector&lt;File&gt; fs;</span><br><span class="line"><span class="type">int</span> curDir;</span><br><span class="line"></span><br><span class="line"><span class="comment">// lexicograhically smaller</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">comp</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; x, <span class="type">const</span> <span class="type">int</span>&amp; y)</span> </span>{</span><br><span class="line">  <span class="keyword">return</span> fs[x].fullpath &lt; fs[y].fullpath;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// compare size first (increasing)</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">comps</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; x, <span class="type">const</span> <span class="type">int</span>&amp; y)</span> </span>{</span><br><span class="line">  <span class="keyword">return</span> fs[x].size &lt; fs[y].size || (fs[x].size == fs[y].size &amp;&amp; fs[x].fullpath &lt; fs[y].fullpath);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// compare size first (decreasing)</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">compS</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; x, <span class="type">const</span> <span class="type">int</span>&amp; y)</span> </span>{</span><br><span class="line">  <span class="keyword">return</span> fs[x].size &gt; fs[y].size || (fs[x].size == fs[y].size &amp;&amp; fs[x].fullpath &lt; fs[y].fullpath);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// return the node number. -1 on error</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findFileInDirectory</span><span class="params">(<span class="type">int</span> node, string name)</span> </span>{</span><br><span class="line">  VI&amp; subdir = fs[node].subdir;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; subdir.<span class="built_in">size</span>(); i++)</span><br><span class="line">    <span class="keyword">if</span>(fs[subdir[i]].name == name) <span class="keyword">return</span> subdir[i];</span><br><span class="line">  <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// if the end of path is '/', remove it first</span></span><br><span class="line"><span class="function">string <span class="title">joinPath</span><span class="params">(string path, string name)</span> </span>{</span><br><span class="line">  <span class="keyword">if</span>(path[path.<span class="built_in">size</span>()<span class="number">-1</span>] != <span class="string">'/'</span>) path += <span class="string">"/"</span>;</span><br><span class="line">  <span class="keyword">return</span> path + name;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// get the absolute path string for a node</span></span><br><span class="line"><span class="function">string <span class="title">getAbsolutePath</span><span class="params">(<span class="type">int</span> node)</span> </span>{</span><br><span class="line">  <span class="keyword">if</span>(!node) <span class="keyword">return</span> <span class="string">"/"</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">joinPath</span>(<span class="built_in">getAbsolutePath</span>(fs[node].parent), fs[node].name);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// create a file (regular/directory) in a node (the caller should ensure that the node represents a directory)</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">createFileInDirectory</span><span class="params">(<span class="type">int</span> node, string name, LL size, <span class="type">bool</span> dir, <span class="type">bool</span> hidden)</span> </span>{</span><br><span class="line">  fs.<span class="built_in">push_back</span>(<span class="built_in">File</span>(node, name, size, dir, hidden));</span><br><span class="line">  <span class="type">int</span> x = fs.<span class="built_in">size</span>()<span class="number">-1</span>;  </span><br><span class="line">  fs[x].fullpath = <span class="built_in">joinPath</span>(<span class="built_in">getAbsolutePath</span>(node), name);</span><br><span class="line">  fs[node].subdir.<span class="built_in">push_back</span>(x);</span><br><span class="line">  <span class="keyword">return</span> x;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// return the node of a path (could be relative path or absolute path). return -1 on error</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getDirNode</span><span class="params">(string path)</span> </span>{</span><br><span class="line">  <span class="keyword">if</span>(!path.<span class="built_in">length</span>()) <span class="keyword">return</span> curDir;</span><br><span class="line">  <span class="type">int</span> node = curDir; <span class="comment">// relative path by default</span></span><br><span class="line">  <span class="keyword">if</span>(path[<span class="number">0</span>] == <span class="string">'/'</span>) node = <span class="number">0</span>; <span class="comment">// absolute path</span></span><br><span class="line">  VS dirs = <span class="built_in">split</span>(path, <span class="string">'/'</span>);</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; dirs.<span class="built_in">size</span>(); i++) {</span><br><span class="line">    <span class="keyword">if</span>(dirs[i] == <span class="string">"."</span>) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(dirs[i] == <span class="string">".."</span>) {</span><br><span class="line">      <span class="keyword">if</span>(!node) <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">// root has no parent</span></span><br><span class="line">      node = fs[node].parent;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="type">int</span> x = <span class="built_in">findFileInDirectory</span>(node, dirs[i]);</span><br><span class="line">      <span class="keyword">if</span>(x == <span class="number">-1</span> || !fs[x].dir) <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">// cannot enter a regular file</span></span><br><span class="line">      node = x;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> node;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// check if the filename is valid</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">isValidFileName</span><span class="params">(string name)</span> </span>{</span><br><span class="line">  <span class="keyword">if</span>(name.<span class="built_in">length</span>() == <span class="number">0</span> || name.<span class="built_in">length</span>() &gt; <span class="number">255</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span>(name == <span class="string">"."</span> || name.<span class="built_in">find</span>(<span class="string">".."</span>) != string::npos) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; name.<span class="built_in">length</span>(); i++)</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">isdigit</span>(name[i]) &amp;&amp; !<span class="built_in">isalpha</span>(name[i]) &amp;&amp; name[i] != <span class="string">'.'</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// split a fullpath into a directory part and a filename part</span></span><br><span class="line"><span class="comment">// return the node of the directory part. return -1 if path not found</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">splitFileName</span><span class="params">(string fullpath, string&amp; filename)</span> </span>{</span><br><span class="line">  <span class="type">int</span> n = fullpath.<span class="built_in">length</span>();</span><br><span class="line">  <span class="type">int</span> x = n;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = fullpath.<span class="built_in">length</span>()<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--) {</span><br><span class="line">    <span class="keyword">if</span>(fullpath[i] == <span class="string">'/'</span>) { <span class="comment">// the last '/'</span></span><br><span class="line">      filename = fullpath.<span class="built_in">substr</span>(i+<span class="number">1</span>);</span><br><span class="line">	  string dir = fullpath.<span class="built_in">substr</span>(<span class="number">0</span>, i);</span><br><span class="line">	  <span class="keyword">if</span>(dir == <span class="string">""</span>) <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// relative to root, NOT current directory</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">getDirNode</span>(dir);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  filename = fullpath;</span><br><span class="line">  <span class="keyword">return</span> curDir;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// new BASH session</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">newSession</span><span class="params">()</span> </span>{ fs.<span class="built_in">clear</span>(); fs.<span class="built_in">push_back</span>(<span class="built_in">File</span>()); curDir = <span class="number">0</span>; }</span><br><span class="line"></span><br><span class="line"><span class="comment">// Given the filename, find all matching files in a node, possibly recursively. Append the items in "out", which is a vector of nodes</span></span><br><span class="line"><span class="comment">// if filename == "", we simply list the files</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">findFileEx</span><span class="params">(VI&amp; out, <span class="type">int</span> node, string filename, <span class="type">bool</span> recur, <span class="type">bool</span> hidden, <span class="type">bool</span> f=<span class="literal">true</span>, <span class="type">bool</span> d=<span class="literal">true</span>)</span> </span>{</span><br><span class="line">  VI&amp; subdir = fs[node].subdir;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; subdir.<span class="built_in">size</span>(); i++) {</span><br><span class="line">    <span class="type">int</span> x = subdir[i];</span><br><span class="line">    <span class="keyword">if</span>(fs[x].dir &amp;&amp; recur) <span class="built_in">findFileEx</span>(out, x, filename, recur, hidden, f, d);</span><br><span class="line">    <span class="keyword">if</span>(fs[x].hidden &amp;&amp; !hidden) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">if</span>(filename == <span class="string">""</span> || fs[x].name == filename) {</span><br><span class="line">      <span class="keyword">if</span>((fs[x].dir &amp;&amp; d) || (!fs[x].dir &amp;&amp; f)) out.<span class="built_in">push_back</span>(x);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// format the file list</span></span><br><span class="line"><span class="function">string <span class="title">formatFiles</span><span class="params">(<span class="type">const</span> VI&amp; out)</span> </span>{</span><br><span class="line">  stringstream ss;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; out.<span class="built_in">size</span>(); i++) {</span><br><span class="line">    ss &lt;&lt; fs[out[i]].fullpath &lt;&lt; <span class="string">" "</span> &lt;&lt; fs[out[i]].size;</span><br><span class="line">    <span class="keyword">if</span>(fs[out[i]].hidden) ss &lt;&lt; <span class="string">" "</span> &lt;&lt; <span class="string">"hidden"</span>;</span><br><span class="line">    <span class="keyword">if</span>(fs[out[i]].dir) ss &lt;&lt; <span class="string">" "</span> &lt;&lt; <span class="string">"dir"</span>;</span><br><span class="line">    ss &lt;&lt; <span class="string">"\n"</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> ss.<span class="built_in">str</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// get arguments and switches</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">parseArgs</span><span class="params">(VS params, VS&amp; args, <span class="type">bool</span>* sw, LL &amp;v)</span> </span>{</span><br><span class="line">  LL v2;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; params.<span class="built_in">size</span>(); i++)</span><br><span class="line">    <span class="keyword">if</span>(params[i][<span class="number">0</span>] == <span class="string">'-'</span>) {</span><br><span class="line">      <span class="keyword">if</span>(<span class="built_in">isalpha</span>(params[i][<span class="number">1</span>])) sw[params[i][<span class="number">1</span>]] = <span class="number">1</span>;</span><br><span class="line">	  <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">get_int</span>(params[i].<span class="built_in">substr</span>(<span class="number">1</span>), v2)) v = v2; <span class="comment">// if there are more than one, only the last one is used</span></span><br><span class="line">	  <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	}</span><br><span class="line">    <span class="keyword">else</span> args.<span class="built_in">push_back</span>(params[i]); <span class="comment">// regular arguments (without prefix '-')</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// run a command (except grep) without piping, returns the standard output</span></span><br><span class="line"><span class="function">string <span class="title">runCommand</span><span class="params">(<span class="type">const</span> VS&amp; cmd)</span> </span>{</span><br><span class="line">  <span class="function">VS <span class="title">params</span><span class="params">(cmd.begin()+<span class="number">1</span>, cmd.end())</span>, args</span>;</span><br><span class="line">  <span class="type">bool</span> sw[<span class="number">256</span>];</span><br><span class="line">  LL v = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(sw, <span class="number">0</span>, <span class="built_in">sizeof</span>(sw));</span><br><span class="line">  <span class="keyword">if</span>(!<span class="built_in">parseArgs</span>(params, args, sw, v)) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">  </span><br><span class="line">  <span class="type">int</span> node;</span><br><span class="line">  string filename;</span><br><span class="line">  <span class="keyword">if</span>(cmd[<span class="number">0</span>] == <span class="string">"cd"</span>) {</span><br><span class="line">    <span class="keyword">if</span>(args.<span class="built_in">size</span>() != <span class="number">1</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">    <span class="keyword">if</span>((node = <span class="built_in">getDirNode</span>(args[<span class="number">0</span>])) == <span class="number">-1</span>) <span class="keyword">return</span> ERROR_DIR_NOT_FOUND;</span><br><span class="line">    curDir = node;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">  } <span class="keyword">else</span> <span class="keyword">if</span>(cmd[<span class="number">0</span>] == <span class="string">"touch"</span>) {</span><br><span class="line">    <span class="keyword">if</span>(args.<span class="built_in">size</span>() != <span class="number">1</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">    <span class="keyword">if</span>((node = <span class="built_in">splitFileName</span>(args[<span class="number">0</span>], filename)) == <span class="number">-1</span>) <span class="keyword">return</span> ERROR_DIR_NOT_FOUND;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">isValidFileName</span>(filename)) <span class="keyword">return</span> ERROR_BAD_USAGE; <span class="comment">//!</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> x = <span class="built_in">findFileInDirectory</span>(node, filename);</span><br><span class="line">    <span class="keyword">if</span>(x != <span class="number">-1</span> &amp;&amp; fs[x].dir) <span class="keyword">return</span> ERROR_DIR_FOUND;</span><br><span class="line">    <span class="keyword">if</span>(x == <span class="number">-1</span>) <span class="built_in">createFileInDirectory</span>(node, filename, v, <span class="literal">false</span>, sw[<span class="string">'h'</span>]);</span><br><span class="line">    <span class="keyword">else</span> { fs[x].size = v; fs[x].hidden = sw[<span class="string">'h'</span>]; }</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span>(cmd[<span class="number">0</span>] == <span class="string">"mkdir"</span>) {</span><br><span class="line">    <span class="keyword">if</span>(args.<span class="built_in">size</span>() != <span class="number">1</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">    <span class="keyword">if</span>((node = <span class="built_in">splitFileName</span>(args[<span class="number">0</span>], filename)) == <span class="number">-1</span>) <span class="keyword">return</span> ERROR_DIR_NOT_FOUND;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">isValidFileName</span>(filename)) <span class="keyword">return</span> ERROR_BAD_USAGE; <span class="comment">//!</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> x = <span class="built_in">findFileInDirectory</span>(node, filename);</span><br><span class="line">    <span class="keyword">if</span>(x != <span class="number">-1</span>) <span class="keyword">return</span> ERROR_DIR_OR_FILE_FOUND;</span><br><span class="line">    <span class="built_in">createFileInDirectory</span>(node, filename, <span class="number">0</span>, <span class="literal">true</span>, sw[<span class="string">'h'</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span>(cmd[<span class="number">0</span>] == <span class="string">"find"</span>) {</span><br><span class="line">    <span class="keyword">if</span>(args.<span class="built_in">size</span>() != <span class="number">1</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">    <span class="keyword">if</span>((node = <span class="built_in">splitFileName</span>(args[<span class="number">0</span>], filename)) == <span class="number">-1</span>) <span class="keyword">return</span> ERROR_DIR_NOT_FOUND;</span><br><span class="line">	</span><br><span class="line">    VI out;</span><br><span class="line">    <span class="built_in">findFileEx</span>(out, node, filename, sw[<span class="string">'r'</span>], sw[<span class="string">'h'</span>]);</span><br><span class="line">    <span class="keyword">if</span>(out.<span class="built_in">size</span>() == <span class="number">0</span>) <span class="keyword">return</span> ERROR_FILE_NOT_FOUND;</span><br><span class="line">    <span class="built_in">sort</span>(out.<span class="built_in">begin</span>(), out.<span class="built_in">end</span>(), comp);</span><br><span class="line">    <span class="keyword">return</span> formatFiles(out);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span>(cmd[<span class="number">0</span>] == <span class="string">"ls"</span>) {</span><br><span class="line">    <span class="keyword">if</span>(args.<span class="built_in">size</span>() &gt; <span class="number">1</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">	node = curDir;</span><br><span class="line">	<span class="keyword">if</span>(args.<span class="built_in">size</span>() == <span class="number">1</span>) <span class="keyword">if</span>((node = <span class="built_in">getDirNode</span>(args[<span class="number">0</span>])) == <span class="number">-1</span>) <span class="keyword">return</span> ERROR_DIR_NOT_FOUND;</span><br><span class="line">	</span><br><span class="line">    VI out;</span><br><span class="line">    <span class="built_in">findFileEx</span>(out, node, <span class="string">""</span>, sw[<span class="string">'r'</span>], sw[<span class="string">'h'</span>], !sw[<span class="string">'d'</span>], !sw[<span class="string">'f'</span>]); <span class="comment">// ignore bad usage "-d -f"</span></span><br><span class="line">    <span class="keyword">if</span>(out.<span class="built_in">size</span>() == <span class="number">0</span>) <span class="keyword">return</span> ERROR_EMPTY;</span><br><span class="line">    <span class="keyword">if</span>(sw[<span class="string">'s'</span>]) <span class="built_in">sort</span>(out.<span class="built_in">begin</span>(), out.<span class="built_in">end</span>(), comps);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(sw[<span class="string">'S'</span>]) <span class="built_in">sort</span>(out.<span class="built_in">begin</span>(), out.<span class="built_in">end</span>(), compS); <span class="comment">// ignore bad usage "-s -S"</span></span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">sort</span>(out.<span class="built_in">begin</span>(), out.<span class="built_in">end</span>(), comp);</span><br><span class="line">    <span class="keyword">return</span> formatFiles(out);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span>(cmd[<span class="number">0</span>] == <span class="string">"pwd"</span>) {</span><br><span class="line">    <span class="keyword">if</span>(args.<span class="built_in">size</span>() != <span class="number">0</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">getAbsolutePath</span>(curDir) + <span class="string">"\n"</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span>(cmd[<span class="number">0</span>] == <span class="string">"exit"</span>) {</span><br><span class="line">    <span class="keyword">if</span>(args.<span class="built_in">size</span>() != <span class="number">0</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">    <span class="built_in">newSession</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span>(cmd[<span class="number">0</span>] == <span class="string">"grep"</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">  <span class="keyword">return</span> ERROR_NO_COMMAND;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// run a commandline (pipes are possible)</span></span><br><span class="line"><span class="function">string <span class="title">runCommandLine</span><span class="params">(string cmd)</span> </span>{</span><br><span class="line">  <span class="comment">// split commands</span></span><br><span class="line">  <span class="type">int</span> n = cmd.<span class="built_in">length</span>();</span><br><span class="line">  <span class="type">int</span> start = <span class="number">0</span>, inq = <span class="number">0</span>;</span><br><span class="line">  VS commands;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; i++)</span><br><span class="line">    <span class="keyword">if</span>(i == n || (cmd[i] == <span class="string">'|'</span> &amp;&amp; !inq))  { commands.<span class="built_in">push_back</span>(cmd.<span class="built_in">substr</span>(start, i-start)); start = i+<span class="number">1</span>; }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cmd[i] == <span class="string">'"'</span>) inq = !inq;</span><br><span class="line">  <span class="keyword">if</span>(!commands.<span class="built_in">size</span>()) <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// run the first command</span></span><br><span class="line">  string lastoutput = <span class="built_in">runCommand</span>(<span class="built_in">split</span>(commands[<span class="number">0</span>]));</span><br><span class="line">  string line, s, ret;</span><br><span class="line">  <span class="comment">// chain the greps after that</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; commands.<span class="built_in">size</span>(); i++) {</span><br><span class="line">    <span class="function">stringstream <span class="title">ss</span><span class="params">(commands[i])</span></span>;</span><br><span class="line">	<span class="keyword">if</span>(!(ss &gt;&gt; s) || s != <span class="string">"grep"</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">	<span class="built_in">getline</span>(ss, s);</span><br><span class="line">	s = <span class="built_in">trim</span>(s);</span><br><span class="line">	<span class="keyword">if</span>(s.<span class="built_in">length</span>() &lt; <span class="number">2</span> || s[<span class="number">0</span>] != <span class="string">'"'</span> || s[s.<span class="built_in">length</span>()<span class="number">-1</span>] != <span class="string">'"'</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">	s = s.<span class="built_in">substr</span>(<span class="number">1</span>, s.<span class="built_in">length</span>()<span class="number">-2</span>); <span class="comment">// get the string to be searched for</span></span><br><span class="line">	</span><br><span class="line">	<span class="function">stringstream <span class="title">input</span><span class="params">(lastoutput)</span></span>;</span><br><span class="line">	ret = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">getline</span>(input, line)) {</span><br><span class="line">      <span class="keyword">if</span>(line.<span class="built_in">find</span>(s) != string::npos) ret += line + <span class="string">"\n"</span>;</span><br><span class="line">	}</span><br><span class="line">	lastoutput = ret;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> lastoutput;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">  string cmd;</span><br><span class="line">  <span class="built_in">newSession</span>();</span><br><span class="line">  <span class="keyword">while</span>(<span class="built_in">getline</span>(cin, cmd)) {</span><br><span class="line">    cout &lt;&lt; <span class="built_in">runCommandLine</span>(cmd);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>我的代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll unsigned long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> VI vector<span class="string">&lt;int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> VS vector<span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> strs stringstream</span></span><br><span class="line"><span class="type">const</span> string ERROR_BAD_USAGE = <span class="string">"bad usage\n"</span>;</span><br><span class="line"><span class="type">const</span> string ERROR_NO_COMMAND = <span class="string">"no such command\n"</span>;</span><br><span class="line"><span class="type">const</span> string ERROR_DIR_NOT_FOUND = <span class="string">"path not found\n"</span>;</span><br><span class="line"><span class="type">const</span> string ERROR_DIR_FOUND = <span class="string">"a directory with the same name exists\n"</span>;</span><br><span class="line"><span class="type">const</span> string ERROR_DIR_OR_FILE_FOUND = <span class="string">"file or directory with the same name exists\n"</span>;</span><br><span class="line"><span class="type">const</span> string ERROR_FILE_NOT_FOUND = <span class="string">"file not found\n"</span>;</span><br><span class="line"><span class="type">const</span> string ERROR_EMPTY = <span class="string">"[empty]\n"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">file</span>{</span><br><span class="line">    string fname;</span><br><span class="line">    ll fsize;</span><br><span class="line">    <span class="type">bool</span> is_dir,is_hidden;</span><br><span class="line">    string fullpath;</span><br><span class="line">    <span class="type">int</span> father;</span><br><span class="line">    VI subs;</span><br><span class="line">    <span class="built_in">file</span>(string fn,ll size,<span class="type">bool</span> dir,<span class="type">bool</span> hidden,<span class="type">int</span> fa): <span class="built_in">fname</span>(fn),<span class="built_in">fsize</span>(size),<span class="built_in">is_dir</span>(dir),<span class="built_in">is_hidden</span>(hidden),<span class="built_in">father</span>(fa)</span><br><span class="line">    {</span><br><span class="line">        subs.<span class="built_in">clear</span>();</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line">vector&lt;file&gt; fs;</span><br><span class="line"><span class="type">int</span> np;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init_else</span><span class="params">(file &amp;f)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span>(f.father&gt;=fs.<span class="built_in">size</span>()) f.fullpath=<span class="string">"w?"</span>;</span><br><span class="line">    <span class="keyword">if</span>(f.father==<span class="number">-1</span>) f.fullpath=<span class="string">"/"</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(f.father==<span class="number">0</span>) f.fullpath=<span class="string">"/"</span>+f.fname;</span><br><span class="line">    <span class="keyword">else</span> f.fullpath=fs[f.father].fullpath+<span class="string">"/"</span>+f.fname;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    fs.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="function">file <span class="title">f</span><span class="params">(<span class="string">""</span>,<span class="number">0</span>,<span class="literal">true</span>,<span class="literal">false</span>,<span class="number">-1</span>)</span></span>;</span><br><span class="line">    <span class="built_in">init_else</span>(f);</span><br><span class="line">    fs.<span class="built_in">push_back</span>(f);</span><br><span class="line">    np=<span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">VS <span class="title">split_pipe</span><span class="params">(string cmd_aline)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    VS v;v.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="type">int</span> flag=<span class="number">1</span>,last=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=cmd_aline.<span class="built_in">length</span>();i++)</span><br><span class="line">        <span class="keyword">if</span>(i==cmd_aline.<span class="built_in">length</span>()||flag&amp;&amp;cmd_aline[i]==<span class="string">'|'</span>)</span><br><span class="line">            v.<span class="built_in">push_back</span>(cmd_aline.<span class="built_in">substr</span>(last,(i-last))),last=i+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(cmd_aline[i]==<span class="string">'\"'</span>)</span><br><span class="line">            flag^=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> v;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">trim</span><span class="params">(string&amp; s)</span>       <span class="comment">// 去空格</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="type">int</span> l=<span class="number">0</span>,r=s.<span class="built_in">length</span>()<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span>(s[l]==<span class="string">' '</span>) l++;</span><br><span class="line">    <span class="keyword">while</span>(s[r]==<span class="string">' '</span>) r--;</span><br><span class="line">    s=s.<span class="built_in">substr</span>(l,(r-l+<span class="number">1</span>)); <span class="comment">// 同时去除了两遍的双引号</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> tf[<span class="number">200</span>];</span><br><span class="line"></span><br><span class="line"><span class="function">VS <span class="title">split_by_space</span><span class="params">(string cmd)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    VS v;  string s;  <span class="function">strs <span class="title">ss</span><span class="params">(cmd)</span></span>;</span><br><span class="line">    <span class="keyword">while</span>(ss&gt;&gt;s) v.<span class="built_in">push_back</span>(s);</span><br><span class="line">    <span class="keyword">return</span> v;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">to_ll</span><span class="params">(string s,ll&amp; v)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="function">strs <span class="title">sin</span><span class="params">(s)</span></span>;</span><br><span class="line">    <span class="keyword">if</span>(sin&gt;&gt;v) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">split_args</span><span class="params">(string &amp;cmd,VS &amp;must,ll &amp;size)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">memset</span>(tf,<span class="number">0</span>,<span class="built_in">sizeof</span>(tf));</span><br><span class="line">    must.<span class="built_in">clear</span>();</span><br><span class="line">    size=<span class="number">0</span>;</span><br><span class="line">    VS cmds=<span class="built_in">split_by_space</span>(cmd);</span><br><span class="line">    ll v;</span><br><span class="line">    <span class="comment">// if(cmds.size()==0) return true;</span></span><br><span class="line">    cmd=cmds[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;cmds.<span class="built_in">size</span>();i++)</span><br><span class="line">        <span class="keyword">if</span>(cmds[i][<span class="number">0</span>]==<span class="string">'-'</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(cmds[i].<span class="built_in">length</span>()&lt;<span class="number">2</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">isalpha</span>(cmds[i][<span class="number">1</span>]))</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">if</span>(tf[cmds[i][<span class="number">1</span>]]) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                tf[cmds[i][<span class="number">1</span>]]=<span class="literal">true</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">to_ll</span>(cmds[i].<span class="built_in">substr</span>(<span class="number">1</span>),v))</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">if</span>(size!=<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                size=v;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> must.<span class="built_in">push_back</span>(cmds[i]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">VS <span class="title">split</span><span class="params">(string s,<span class="type">char</span> ch)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    VS v;</span><br><span class="line">    string ns=<span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;s.<span class="built_in">length</span>();i++)</span><br><span class="line">        <span class="keyword">if</span>(s[i]==ch) v.<span class="built_in">push_back</span>(ns),ns=<span class="string">""</span>;</span><br><span class="line">        <span class="keyword">else</span> ns=ns+s[i];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(ns!=<span class="string">""</span>) v.<span class="built_in">push_back</span>(ns);</span><br><span class="line">    <span class="keyword">return</span> v;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find_son</span><span class="params">(<span class="type">int</span> p,string str)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span>(p&lt;<span class="number">0</span>||p&gt;=fs.<span class="built_in">size</span>()) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;fs[p].subs.<span class="built_in">size</span>();i++)</span><br><span class="line">        <span class="keyword">if</span>(fs[fs[p].subs[i]].fname==str)</span><br><span class="line">            <span class="keyword">return</span> fs[p].subs[i];</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find_dir</span><span class="params">(string dir)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span>(dir==<span class="string">""</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(dir==<span class="string">"/"</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> nq=np;</span><br><span class="line">    <span class="keyword">if</span>(dir[<span class="number">0</span>]==<span class="string">'/'</span>) nq=<span class="number">0</span>,dir=dir.<span class="built_in">substr</span>(<span class="number">1</span>);</span><br><span class="line">    VS dirs=<span class="built_in">split</span>(dir,<span class="string">'/'</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;dirs.<span class="built_in">size</span>();i++)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span>(dirs[i]==<span class="string">""</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(dirs[i]==<span class="string">"."</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(dirs[i]==<span class="string">".."</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(nq==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">else</span> nq=fs[nq].father;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        nq=<span class="built_in">find_son</span>(nq,dirs[i]);</span><br><span class="line">        <span class="keyword">if</span>(nq==<span class="number">-1</span>||!fs[nq].is_dir) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> nq;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">split_fp</span><span class="params">(<span class="type">int</span>&amp; path,string&amp; fname)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="type">size_t</span> pt=fname.<span class="built_in">rfind</span>(<span class="string">"/"</span>);</span><br><span class="line">    <span class="keyword">if</span>(pt==fname.npos) path=np;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">        path=<span class="built_in">find_dir</span>(fname.<span class="built_in">substr</span>(<span class="number">0</span>,pt));</span><br><span class="line">        fname=fname.<span class="built_in">substr</span>(pt+<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">fn_is_valid</span><span class="params">(string fname)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span>(fname.<span class="built_in">length</span>()==<span class="number">0</span>||fname.<span class="built_in">length</span>()&gt;<span class="number">255</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(fname==<span class="string">"."</span>||fname.<span class="built_in">find</span>(<span class="string">".."</span>)!=fname.npos) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;fname.<span class="built_in">length</span>();i++)</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">isdigit</span>(fname[i])&amp;&amp;!<span class="built_in">isalpha</span>(fname[i])&amp;&amp;fname[i]!=<span class="string">'.'</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">check_file_name</span><span class="params">(string filename,<span class="type">int</span> father)</span>  <span class="comment">//-1:no x:file -2:dir</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span>(father&lt;<span class="number">0</span>||father&gt;=fs.<span class="built_in">size</span>()) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;fs[father].subs.<span class="built_in">size</span>();i++)</span><br><span class="line">        <span class="keyword">if</span>(fs[fs[father].subs[i]].fname==filename)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(fs[fs[father].subs[i]].is_dir) <span class="keyword">return</span> <span class="number">-2</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> fs[father].subs[i];</span><br><span class="line">        }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">string <span class="title">make_file</span><span class="params">(string filename,ll size,<span class="type">int</span> father,<span class="type">bool</span> is_hidden)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="type">int</span> ret=<span class="built_in">check_file_name</span>(filename,father);</span><br><span class="line">    <span class="keyword">if</span>(ret==<span class="number">-2</span>) <span class="keyword">return</span> ERROR_DIR_FOUND;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(ret==<span class="number">-1</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="function">file <span class="title">f</span><span class="params">(filename,size,<span class="literal">false</span>,is_hidden,father)</span></span>;</span><br><span class="line">        <span class="built_in">init_else</span>(f);</span><br><span class="line">        fs.<span class="built_in">push_back</span>(f);</span><br><span class="line">        fs[father].subs.<span class="built_in">push_back</span>(fs.<span class="built_in">size</span>()<span class="number">-1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">        fs[ret].fsize=size;</span><br><span class="line">        fs[ret].is_hidden=is_hidden;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">string <span class="title">make_dir</span><span class="params">(string filename,<span class="type">int</span> father,<span class="type">bool</span> is_hidden)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">check_file_name</span>(filename,father)!=<span class="number">-1</span>) <span class="keyword">return</span> ERROR_DIR_OR_FILE_FOUND;</span><br><span class="line"></span><br><span class="line">    <span class="function">file <span class="title">f</span><span class="params">(filename,<span class="number">0</span>,<span class="literal">true</span>,is_hidden,father)</span></span>;</span><br><span class="line">    <span class="built_in">init_else</span>(f);</span><br><span class="line">    fs.<span class="built_in">push_back</span>(f);</span><br><span class="line">    fs[father].subs.<span class="built_in">push_back</span>(fs.<span class="built_in">size</span>()<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">find</span><span class="params">(<span class="type">int</span> path,string filename,VI &amp;ans,<span class="type">bool</span> r)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;fs[path].subs.<span class="built_in">size</span>();i++)</span><br><span class="line">    {</span><br><span class="line">        file&amp; f=fs[fs[path].subs[i]];</span><br><span class="line">        <span class="keyword">if</span>(filename==<span class="string">""</span>||f.fname==filename) ans.<span class="built_in">push_back</span>(fs[path].subs[i]);</span><br><span class="line">        <span class="keyword">if</span>(r&amp;&amp;f.is_dir) <span class="built_in">find</span>(fs[path].subs[i],filename,ans,r);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">return</span> fs[a].fullpath&lt;fs[b].fullpath;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp_s</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span>(fs[a].fsize!=fs[b].fsize) <span class="keyword">return</span> fs[a].fsize&lt;fs[b].fsize;</span><br><span class="line">    <span class="keyword">return</span> fs[a].fullpath&lt;fs[b].fullpath;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp_S</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span>(fs[a].fsize!=fs[b].fsize) <span class="keyword">return</span> fs[a].fsize&gt;fs[b].fsize;</span><br><span class="line">    <span class="keyword">return</span> fs[a].fullpath&lt;fs[b].fullpath;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">string <span class="title">run_cmd</span><span class="params">(string cmd)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span>(np&lt;<span class="number">0</span>||np&gt;=fs.<span class="built_in">size</span>()) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">    ll size=<span class="number">0</span>;</span><br><span class="line">    VS must;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">split_args</span>(cmd,must,size)) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">    <span class="keyword">if</span>(cmd==<span class="string">"cd"</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span>(must.<span class="built_in">size</span>()!=<span class="number">1</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">        <span class="type">int</span> nd=<span class="built_in">find_dir</span>(must[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">if</span>(nd==<span class="number">-1</span>) <span class="keyword">return</span> ERROR_DIR_NOT_FOUND;</span><br><span class="line"></span><br><span class="line">        np=nd;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(cmd==<span class="string">"mkdir"</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span>(must.<span class="built_in">size</span>()!=<span class="number">1</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">        <span class="type">int</span> path;string fn=must[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="built_in">split_fp</span>(path,fn);</span><br><span class="line">        <span class="keyword">if</span>(path==<span class="number">-1</span>) <span class="keyword">return</span> ERROR_DIR_NOT_FOUND;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">fn_is_valid</span>(fn)) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_dir</span>(fn,path,tf[<span class="string">'h'</span>]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(cmd==<span class="string">"touch"</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span>(must.<span class="built_in">size</span>()!=<span class="number">1</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">        <span class="type">int</span> path;string fn=must[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="built_in">split_fp</span>(path,fn);</span><br><span class="line">        <span class="keyword">if</span>(path==<span class="number">-1</span>) <span class="keyword">return</span> ERROR_DIR_NOT_FOUND;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">fn_is_valid</span>(fn)) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_file</span>(fn,size,path,tf[<span class="string">'h'</span>]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(cmd==<span class="string">"find"</span>)</span><br><span class="line">    {   </span><br><span class="line">        VI ans;</span><br><span class="line">        <span class="keyword">if</span>(must.<span class="built_in">size</span>()!=<span class="number">1</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">        <span class="type">int</span> path;string fn=must[<span class="number">0</span>];</span><br><span class="line">        <span class="built_in">split_fp</span>(path,fn);</span><br><span class="line">        <span class="keyword">if</span>(path==<span class="number">-1</span>) <span class="keyword">return</span> ERROR_DIR_NOT_FOUND;</span><br><span class="line">        <span class="built_in">find</span>(path,fn,ans,tf[<span class="string">'r'</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">sort</span>(ans.<span class="built_in">begin</span>(),ans.<span class="built_in">end</span>(),cmp);</span><br><span class="line"></span><br><span class="line">        strs ss;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;ans.<span class="built_in">size</span>();i++)</span><br><span class="line">            <span class="keyword">if</span>(tf[<span class="string">'h'</span>]||!fs[ans[i]].is_hidden)</span><br><span class="line">            {</span><br><span class="line">                ss&lt;&lt;fs[ans[i]].fullpath&lt;&lt;<span class="string">" "</span>&lt;&lt;fs[ans[i]].fsize;</span><br><span class="line">                <span class="keyword">if</span>(fs[ans[i]].is_hidden) ss&lt;&lt;<span class="string">" hidden"</span>;</span><br><span class="line">                <span class="keyword">if</span>(fs[ans[i]].is_dir) ss&lt;&lt;<span class="string">" dir"</span>;</span><br><span class="line">                ss&lt;&lt;endl;</span><br><span class="line">            }</span><br><span class="line">        string res=ss.<span class="built_in">str</span>();</span><br><span class="line">        <span class="keyword">if</span>(res==<span class="string">""</span>) res=ERROR_FILE_NOT_FOUND;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(cmd==<span class="string">"ls"</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span>(must.<span class="built_in">size</span>()&gt;<span class="number">1</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">        <span class="comment">// if(tf['d']&amp;&amp;tf['f']) return "[empty]\n";</span></span><br><span class="line">        VI ans;</span><br><span class="line">        <span class="type">int</span> path=np;</span><br><span class="line">        <span class="keyword">if</span>(must.<span class="built_in">size</span>()!=<span class="number">0</span>) path=<span class="built_in">find_dir</span>(must[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">if</span>(path==<span class="number">-1</span>) <span class="keyword">return</span> ERROR_DIR_NOT_FOUND;</span><br><span class="line">        <span class="built_in">find</span>(path,<span class="string">""</span>,ans,tf[<span class="string">'r'</span>]);</span><br><span class="line">        <span class="comment">// cout&lt;&lt;ans.size()&lt;&lt;endl;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(tf[<span class="string">'s'</span>]) <span class="built_in">sort</span>(ans.<span class="built_in">begin</span>(),ans.<span class="built_in">end</span>(),cmp_s);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(tf[<span class="string">'S'</span>]) <span class="built_in">sort</span>(ans.<span class="built_in">begin</span>(),ans.<span class="built_in">end</span>(),cmp_S);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">sort</span>(ans.<span class="built_in">begin</span>(),ans.<span class="built_in">end</span>(),cmp);</span><br><span class="line"></span><br><span class="line">        strs ss;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;ans.<span class="built_in">size</span>();i++)</span><br><span class="line">            <span class="keyword">if</span>((tf[<span class="string">'h'</span>]||!fs[ans[i]].is_hidden) &amp;&amp; ( (!tf[<span class="string">'d'</span>] &amp;&amp; !tf[<span class="string">'f'</span>]) || (tf[<span class="string">'d'</span>] &amp;&amp; fs[ans[i]].is_dir) || (tf[<span class="string">'f'</span>] &amp;&amp; !fs[ans[i]].is_dir)))</span><br><span class="line">            {</span><br><span class="line">                ss&lt;&lt;fs[ans[i]].fullpath&lt;&lt;<span class="string">" "</span>&lt;&lt;fs[ans[i]].fsize;</span><br><span class="line">                <span class="keyword">if</span>(fs[ans[i]].is_hidden) ss&lt;&lt;<span class="string">" hidden"</span>;</span><br><span class="line">                <span class="keyword">if</span>(fs[ans[i]].is_dir) ss&lt;&lt;<span class="string">" dir"</span>;</span><br><span class="line">                ss&lt;&lt;endl;</span><br><span class="line">            }</span><br><span class="line">        string res=ss.<span class="built_in">str</span>();</span><br><span class="line">        <span class="keyword">if</span>(res==<span class="string">""</span>) res=ERROR_EMPTY;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(cmd==<span class="string">"pwd"</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span>(must.<span class="built_in">size</span>()!=<span class="number">0</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">        <span class="keyword">return</span> fs[np].fullpath+<span class="string">"\n"</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(cmd==<span class="string">"exit"</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span>(must.<span class="built_in">size</span>()!=<span class="number">0</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">        <span class="built_in">init</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(cmd==<span class="string">"grep"</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">    <span class="keyword">return</span> ERROR_NO_COMMAND;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">string <span class="title">run_aline</span><span class="params">(string cmd_aline)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    VS cmd_pipe=<span class="built_in">split_pipe</span>(cmd_aline);</span><br><span class="line">    string result=<span class="built_in">run_cmd</span>(cmd_pipe[<span class="number">0</span>]),s,gl;</span><br><span class="line">    <span class="comment">// if(result==BAD_USAGE_ERROR) return BAD_USAGE_ERROR;</span></span><br><span class="line">    <span class="type">bool</span> flag=<span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// if(result==NO_SUCH_COMMAND_ERROR) flag=true;</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;cmd_pipe.<span class="built_in">size</span>();i++)</span><br><span class="line">    {</span><br><span class="line">        <span class="function">strs <span class="title">ss</span><span class="params">(cmd_pipe[i])</span></span>;</span><br><span class="line">        <span class="keyword">if</span>(!(ss&gt;&gt;s)||s!=<span class="string">"grep"</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">        <span class="built_in">getline</span>(ss,s);</span><br><span class="line">        <span class="built_in">trim</span>(s);</span><br><span class="line">        <span class="keyword">if</span>(s.<span class="built_in">length</span>()&lt;<span class="number">2</span>||s[<span class="number">0</span>]!=<span class="string">'\"'</span>||s[s.<span class="built_in">length</span>()<span class="number">-1</span>]!=<span class="string">'\"'</span>) <span class="keyword">return</span> ERROR_BAD_USAGE;</span><br><span class="line">        s=s.<span class="built_in">substr</span>(<span class="number">1</span>,s.<span class="built_in">length</span>()<span class="number">-2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="function">strs <span class="title">ss_res</span><span class="params">(result)</span></span>;</span><br><span class="line">        <span class="function">strs <span class="title">ss_out</span><span class="params">(<span class="string">""</span>)</span></span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">getline</span>(ss_res,gl))</span><br><span class="line">            <span class="keyword">if</span>(gl.<span class="built_in">find</span>(s)!=gl.npos)</span><br><span class="line">                ss_out&lt;&lt;gl&lt;&lt;endl;</span><br><span class="line">        result=ss_out.<span class="built_in">str</span>();</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// if(flag) return NO_SUCH_COMMAND_ERROR;</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    string cmd;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">getline</span>(cin,cmd))</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span>(cmd!=<span class="string">""</span>) cout&lt;&lt;<span class="built_in">run_aline</span>(cmd);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>
        </div>
        
            <div class="kratos-copyright text-center clearfix">
                <h5 itemprop="copyrightNotice">本作品采用 <a rel="license nofollow" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a> 进行许可</h5>
            </div>
        
        <footer class="kratos-entry-footer clearfix">
            
                <div class="post-like-donate text-center clearfix" id="post-like-donate">
                
                
                    <a class="share" href="javascript:;"><i class="fa fa-share-alt"></i> 分享</a>
                    <div class="share-wrap" style="display: none;">
    <div class="share-group">
        <a href="javascript:;" class="share-plain qq" onclick="share('qq');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-qq"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain qzone" onclick="share('qzone');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-star"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weixin pop style-plain" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weixin"></i>
            </div>
            <div class="share-int">
                <div class="qrcode" id="wechat-qr"></div>
                <p>打开微信“扫一扫”，打开网页后点击屏幕右上角分享按钮</p>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weibo" onclick="share('weibo');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weibo"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain facebook style-plain" onclick="share('facebook');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-facebook"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain twitter style-plain" onclick="share('twitter');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-twitter"></i>
            </div>
        </a>
    </div>
    <script type="text/javascript">
        $(()=>{
            new QRCode("wechat-qr", {
                text: "https://www.lotuses.net/2022/07/29/solution-uva10966/",
                width: 150,
                height: 150,
                correctLevel : QRCode.CorrectLevel.H
            });
        });
        function share(dest) {
            const qqBase        = "https://connect.qq.com/widget/shareqq/index.html?";
            const weiboBase     = "https://service.weibo.com/share/share.php?";
            const qzoneBase     = "https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?";
            const facebookBase  = "https://www.facebook.com/sharer/sharer.php?";
            const twitterBase   = "https://twitter.com/intent/tweet?";
            const hostUrl       = "https://www.lotuses.net/2022/07/29/solution-uva10966/";
            const title         = "「UVA10966 3KP-BASH Project Sol.」";
            const excerpt       = `啊…太坑了
我放弃了
为了让后人不再掉坑，我在这里将刘汝佳在《算法竞赛入门经典——训练指南》中的翻译打出来。
（为了加强严密性，题目文字根据官方数据进行了增删）
你的任务是为一个假想的 3KP 操作系统编写一个简单的 Bash 模拟器...`;
            let _URL;
            switch (dest) {
                case "qq"       : _URL = qqBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";     break;
                case "weibo"    : _URL = weiboBase+"url="+hostUrl+"&title="+title+excerpt;                                 break;
                case "qzone"    : _URL = qzoneBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";  break;
                case "facebook" : _URL = facebookBase+"u="+hostUrl;                                                        break;
                case "twitter"  : _URL = twitterBase+"text="+title+excerpt+"&url="+hostUrl;                                break;
            }
            window.open(_URL);
        };
    </script>
</div>
                
                </div>
            
            <div class="footer-tag clearfix">
                <div class="pull-left">
                <i class="fa fa-tags"></i>
                    
                </div>
                <div class="pull-date">
                    <time datetime="2022-07-29T07:56:31.643Z" itemprop="dateModified">最后编辑：2022-07-29</time>
                </div>
            </div>
        </footer>
    </div>
    
        <nav class="navigation post-navigation clearfix" role="navigation">
            
            <div class="nav-previous clearfix">
                <a title=" CF1260A Heating" href="/2022/07/29/solution-cf1260a/">&lt; 上一篇</a>
            </div>
            
            
            <div class="nav-next clearfix">
                <a title=" P7964 Kaučuk 题解" href="/2022/07/29/solution-p7964/">下一篇 &gt;</a>
            </div>
            
        </nav>
    
    
        <link rel="stylesheet" href="/vendors/gitalk@1.7.2/dist/gitalk.css"></script>
<div id="gitalk-container" class="post-comments lazy-load" style="padding-left:2rem; padding-right:2rem;"></div>
<script>
    var load_comm = () => {
        const init = () => {
            console.log('Gitalk loading...');
            const gitalk = new Gitalk(Object.assign({
                id: '/2022/07/29/solution-uva10966/',
                path: '/2022/07/29/solution-uva10966/'
            }, JSON.parse('{"clientID":"7a41543bab203de00687","clientSecret":"8dcbcc9cbd8d09fedb7023e655899940e13ef17d","repo":"BlogTalk","owner":"Lotuses-robot","admin":["Candinya","Lotuses-robot"],"distractionFreeMode":true,"proxy":"https://vercel.prohibitorum.top/github_access_token"}')));

            gitalk.render('gitalk-container');
        }
        if (typeof Gitalk === 'undefined') {
            const src = '/vendors/gitalk@1.7.2/dist/gitalk.min.js';
            $.getScript(src, init);
        } else {
            init();
        }
    };
</script>
<noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://github.com/gitalk/gitalk">comments powered by Gitalk.</a></noscript>
    
</article>

        

            </section>

        

                
            

<section id="kratos-widget-area" class="col-md-4 hidden-xs hidden-sm">
    <!-- 文章和页面根据splitter来分割，没有的话就从头开始设置为sticky -->
    
    
                <aside id="krw-about" class="widget widget-kratos-about clearfix">
    <div class="photo-background"></div>
    <div class="photo-wrapper clearfix">
        <div class="photo-wrapper-tip text-center">
            <img class="about-photo" src="https://cdn.luogu.com.cn/upload/usericon/414231.png" loading="lazy" decoding="auto" />
        </div>
    </div>
    <div class="textwidget">
        <p class="text-center">Deserted World.</p>
    </div>
    <div class="site-meta">
        <a class="meta-item" href="/archives/">
            <span class="title">
                文章
            </span>
            <span class="count">
                58
            </span>
        </a>
        <a class="meta-item" href="/categories/">
            <span class="title">
                分类
            </span>
            <span class="count">
                0
            </span>
        </a>
        <a class="meta-item" href="/tags/">
            <span class="title">
                标签
            </span>
            <span class="count">
                6
            </span>
        </a>
    </div>
</aside>
            
                    <div class="sticky-area">
                
                    <aside id="krw-toc" class="widget widget-kratos-toc clearfix toc-div-class" >
    <div class="photo-background"></div>
    <h4 class="widget-title no-after">
        <i class="fa fa-compass"></i>
        文章目录
        <span class="toc-progress-bar" role="progressbar" aria-label="阅读进度："></span>
    </h4>
    <div class="textwidget">
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-cd-path"><span class="toc-text">1. cd path</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-touch-filename-size-h"><span class="toc-text">2. touch filename [-size] [-h]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-mkdir-path-h"><span class="toc-text">3. mkdir path [-h]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-find-filename-r-h"><span class="toc-text">4. find filename [-r] [-h]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-ls-path-h-r-s-S-f-d"><span class="toc-text">5. ls [path] [-h] [-r] [-s] [-S] [-f] [-d]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-pwd"><span class="toc-text">6. pwd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-exit"><span class="toc-text">7. exit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-grep-%E2%80%9Cstring%E2%80%9D"><span class="toc-text">8. grep “string”</span></a></li></ol>
    </div>
</aside>
                
                

            
                
  <aside id="krw-tags" class="widget widget-kratos-tags clearfix">
    <h4 class="widget-title"><i class="fa fa-tags"></i>标签聚合</h4>
      <div class="tag-clouds">
        <a href="/tags/%E4%BA%8C%E5%88%86/" style="font-size: 0.6em;">二分</a> <a href="/tags/%E5%88%9D%E8%B5%9B/" style="font-size: 0.6em;">初赛</a> <a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 0.8em;">总结</a> <a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 0.7em;">数学</a> <a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size: 0.7em;">笔记</a> <a href="/tags/%E9%A2%98%E8%A7%A3/" style="font-size: 0.7em;">题解</a>
      </div>
  </aside>

            
                
  <aside id="krw-posts" class="widget widget-kratos-posts">
  <h4 class="widget-title"><i class="fa fa-file"></i>最新文章</h4>
  <div class="tab-content">
      <ul class="list-group">
        
        
          
          
            <a class="list-group-item" href="/2023/07/05/DP-Study-Note/"><i class="fa  fa-book"></i> DP 技巧学习笔记</a>
            
          
        
          
          
            <a class="list-group-item" href="/2023/07/04/0-1-study-note/"><i class="fa  fa-book"></i> 0-1 思维学习笔记</a>
            
          
        
          
          
            <a class="list-group-item" href="/2023/05/10/P9308-Solution/"><i class="fa  fa-book"></i> P9308 Solution</a>
            
          
        
          
          
            <a class="list-group-item" href="/2023/05/10/Math-All-in-One/"><i class="fa  fa-book"></i> 数论定理公理大全</a>
            
          
        
          
          
            <a class="list-group-item" href="/2023/04/14/fill-problem/"><i class="fa  fa-book"></i> 初赛自创填空题</a>
            
          
        
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
      </ul>
  </div>
  </aside>

            
    </div>
</section>
        
        </div>
    </div>
</div>
<footer>
    <div id="footer"  >
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3 footer-list text-center">
                    <ul class="kratos-social-icons">
                        <!-- Keep for compatibility -->
                        
                        <li><a href="mailto:robot1497833202@qq.com"><i class="fa fa-envelope"></i></a></li>
                        
                        
                        
                        
                        
                        <li><a target="_blank" rel="nofollow" href="https://github.com/Lotuses-robot"><i class="fa fa-github"></i></a></li>
                        
                        <!-- New links -->
                        
                    </ul>
                    <ul class="kratos-copyright">
                        <div>
                            <li>&copy; 2023 Lotuses's Blog 版权所有.</li>
                            <li>本站已运行<span id="span_dt">Loading...</span></li>
                        </div>
                        <div>
                            <li>Theme <a href="https://github.com/Candinya/Kratos-Rebirth" target="_blank">Kratos:Rebirth</a></li>
                            <li>Site built with&nbsp;<i class="fa fa-heart throb" style="color:#d43f57"></i>&nbsp;by Lotuses.</li>
                        </div>
                        <div>
                            <li>Powered by <a href="https://hexo.io" target="_blank" rel="nofollow">Hexo</a></li>
                            <li>Hosted on <a href="https://github.io" target="_blank">Github Pages</a></li>
                        </div>
                        <div>
                            
                            
                        </div>
                    </ul>
                </div>
            </div>
        </div>
        <div class="kr-tool text-center">
            <div class="tool">
                
                    <div class="box search-box">
                        <a href="/search/">
                            <span class="fa fa-search"></span>
                        </a>
                    </div>
                
                
                    <div class="box theme-box" id="darkmode-switch">
                        <span class="fa fa-adjust"></span>
                    </div>
                
                
                
            </div>
            <div class="box gotop-box">
                <span class="fa fa-chevron-up"></span>
            </div>
        </div>
    </div>
</footer>
</div>
</div>

        <script defer src="/vendors/bootstrap@3.3.4/dist/js/bootstrap.min.js"></script>
<script defer src="/vendors/nprogress@0.2.0/nprogress.js"></script>
<script>
    if (!window.kr) {
        window.kr = {};
    }
    window.kr.notMobile = (!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)));
    window.kr.siteRoot = "/";
</script>


    <script async src="/js/candy.min.js"></script>




    <script defer src="/vendors/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

<script defer src="/js/kratosr.min.js"></script>
<script defer src="/js/pjax.min.js"></script>



<!-- Extra support for third-party plguins  -->


    </body>
</html>